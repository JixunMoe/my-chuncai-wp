/*
 Copyright 2014+, Jixun.Org
 WeiChunCai Plugin for WordPress:
   https://github.com/JixunMoe/my-chuncai-wp
*/
jQuery(function(a){var k=window,E=k.jx_wcc,F=k.localStorage;a.fn.clickEx=function(b,d){return a(this).on("click",b,d)};if(F){var W=function(b,a,g,s){g||(g=function(){return!0});var l=a||b,v=l.parentNode,m=function(a){var b=a.offsetParent!=v&&a.offsetParent?m(a.offsetParent):{x:0,y:0};return{x:a.offsetLeft+b.x,y:a.offsetTop+b.y}},f=!1;a=function(a,c,d){(d?document:b).addEventListener(a,c,!1)};_that_unbind=function(a,c,d){(d?document:b).removeEventListener(a,c,!1)};var n=0,w=0,q={x:0,y:0},c=function(a){return a&&
a.parentNode?l==a?!0:c(a.parentNode):!1},e=function(a){b.style.cursor="-webkit-grab";b.style.cursor="grab";f&&a&&s(m(b));f=!1};a("mousedown",function(a){c(a.target)&&g(a)&&(q=m(l),n=a.pageX,w=a.pageY,f=!0,b.style.cursor="-webkit-grabbing",b.style.cursor="grabbing")});a("mouseup",e,!0);a("mousemove",function(a){f&&g(a)&&(l.style.left=q.x+a.pageX-n+"px",l.style.top=q.y+a.pageY-w+"px",a.preventDefault())},!0);e({})},Q=function(a,d,g){return(g||1)*(Math.random()*(d-a)+a)},G=function(a){return a[Math.floor(Math.random()*
a.length)]},P=function(b){var d=b.c,g,s,l=function(){v();w.stop().fadeOut(600);n.fadeIn();if(-1!==b.wcc_enable.indexOf(d.body))g=d.body;else{var a;a=b.wcc_enable;if(a.length)a=G(a);else throw Error("\u8bf7\u901a\u77e5\u7ba1\u7406\u5458\u8fdb\u5165\u540e\u53f0\u914d\u7f6e\u6625\u83dc :<");g=a}s=b.wcc[g];p();t(!0)},v=function(a){n.hide();clearTimeout(x);clearTimeout(y);w.stop().fadeIn(600)},m=function(){F.jx_wcc_conf=JSON.stringify(d)},f=0,n=a("<div>").appendTo("body").addClass("jx_wcc_main").css({left:d.pos.x,
top:d.pos.y}),w=a("<a>").appendTo("body").addClass("jx_wcc_btn_shoukan").text("\u53ec\u5524\u6625\u83dc").hide().click(function(){l();d.hide=!1;m()}),q=a("<div>").appendTo(n).addClass("jx_wcc_face"),c=0,e=a("<div>").appendTo(n).addClass("jx_wcc_chat"),k=a("<div>").appendTo(e).addClass("jx_wcc_cat_con"),p=function(a){a||(c=0);C.add(I).add(J).add(K).stop().slideUp()};a("<a>").text();var E=[a("<a>").text("\u663e\u793a\u516c\u544a").click(function(){p();c+=5E3;h(b.announcement)}),a("<a>").text("\u5b58\u6d3b\u65f6\u95f4").click(function(){p();
c+=5E3;h("\u54b1\u5df2\u7ecf\u548c\u4e3b\u4eba\u5171\u540c\u5ea6\u8fc7\u4e86 "+Math.floor((new Date/1E3-b.since)/86400)+"\u5929 \u7684\u4eba\u751f\u4e86\u54e6~   \u6211\u662f\u4e0d\u662f\u5f88\u68d2\u5462~")}),a("<a>").text("\u62cd\u6253\u5582\u98df").click(function(){c+=15E3;h("\u8981\u6765\u70b9\u4ec0\u4e48\u5462~");C.slideToggle();J.slideToggle()}),a("<a>").text("\u6362 \u4e00 \u53ea").click(function(){p();h("\u4f60\u60f3\u8981\u54ea\u4e00\u53ea\u5462?");K.slideDown()}),a("<a>").text("\u4f20 \u9001 \u95e8").click(function(){c+=
15E3;p();h("\u60f3\u5230\u54ea\u91cc\u53bb\u5462?");I.slideDown()}),a("<a>").text("\u5173\u95ed\u6625\u83dc").click(function(){p();c=1E4;d.hide=!0;m();h("\u8bb0\u5f97\u518d\u53eb\u6211\u51fa\u6765\u54e6~",function(){setTimeout(function(){a(n).fadeOut(600,function(){v();d.hide=!0;m()})},2E3)})}),a("<a>").text("\u8fd4\u56de").click(function(){z(!0);t()})],u=0,R=function(){0<u&&u--;setTimeout(R,42E4)},C=a("<div>").appendTo(e).append(E).addClass("jx_wcc_chat_m").hide(),J=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide().clickEx("a",
function(){c+=3E3;var H="";9<u?h("\u4e3b\u4eba .. ..  \u6211\u5df2\u7ecf\u5403\u4e0d\u4e0b\u4e86 QwQ"):(5<u?H="\u5feb\u5403\u4e0d\u4e0b\u4e86\u2026":3>u&&(H="\u591a\u8c22\u4e3b\u4eba~"),u++,h((H+" "+a(this).attr("r")).trim()))}),K=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide().clickEx("a",function(){d.body=a(this).attr("m");m();l()}),I=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide();a("<div>").appendTo(e).click(function(){C.is(":hidden")?(p(),h("\u9700\u8981\u505a\u70b9\u4ec0\u4e48\u5417?"),
c+=15E3,C.slideToggle()):z(!0)}).text("menu").addClass("jx_wcc_ment_btn");var P=a("<img>").appendTo(q).hide(),L=a("<img>").appendTo(q).hide();new W(q[0],n[0],null,function(a){d.pos=a;m()});var S=!1,T=function(a,b){q.css({width:a.w,height:a.h,backgroundImage:"url("+b+")"})},A={},U=function(a,b){if(A[a]&&A[a].h)b(A[a],a);else{var c=P[0];c.onload=function(){A[a]={w:c.width,h:c.height};b(A[a],a)};c.src=a}},x=0,B=0,h=function(a,b,c){clearTimeout(k.data("jx-jqfx-type"));var d=0,e=a.length,f=function(){k.append("\n"==
a[d]?"<br>":a[d]);++d<e?k.data("jx-jqfx-type",setTimeout(f,c||35)):b&&b()};k.text("").data("jx-jqfx-type",setTimeout(f,1))},V=0,z=function(a){if(a||4E3<new Date-V)p(!0),V=new Date,h(G(b.randTalk))},M=function(a,c){return b.skin+g+a+(c?"."+c:"")+".png"},D=[],N=function(){if(B==D.length)B=0,L.hide(),x=setTimeout(N,Q(f.time[0],f.time[1],1E3));else{var a=D[B++];L.attr("src",M(f.base,a[0])).css({left:a[1],top:a[2],position:"absolute"}).show();x=setTimeout(N,1E3*a[3])}},X=function(a){U(M(f.base),function(b,
c){T(b,c);B=D.length;x=setTimeout(N,1);y=setTimeout(t,O);z(a)})},O=0,y=0,t=function(a){clearTimeout(y);!a&&c?(y=setTimeout(t,c),c=0):(O=Q(s.time[0]||10,s.time[1]||15,1E3),f=G(s.faces),S="string"!=typeof f,clearTimeout(x),L.hide(),S?(B=0,D=f.face,X(a)):U(M(f),function(a,b){T(a,b);y=setTimeout(t,O);z()}))},r;for(r in b.feedPlay)e=b.feedPlay[r],J.append(a("<a>").text(r).attr({f:r,r:e}));for(e=b.wcc_enable.length;e--;)K.append(a("<a>").text(b.wcc[b.wcc_enable[e]].name).attr("m",b.wcc_enable[e]));for(r in b.favLink)I.append(a("<a>").text(r).attr("href",
b.favLink[r]));l();R();t();d.hide?v(!0):(z(!0),c=3E3,h(b.announcement))};a.ajax({url:E.url,method:"POST",data:{action:"jx_ajax_get_chuncai_opts"},dataType:"json",cache:!0}).success(function(b){P(a.extend({c:a.parseJSON(F.jx_wcc_conf)||{pos:{x:a(k).width()-120,y:a(k).height()-200},hide:!1}},b))})}});
