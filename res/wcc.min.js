/*
 Copyright 2014+, Jixun.Org
 WeiChunCai Plugin for WordPress:
   https://github.com/JixunMoe/my-chuncai-wp
*/
jQuery(function(a){var h=window,G=h.jx_wcc,B=h.localStorage;a.fn.clickEx=function(b,d){return a(this).on("click",b,d)};if(B){var X=function(b,a,g,s){g||(g=function(){return!0});var k=a||b,v=k.parentNode,l=function(a){var b=a.offsetParent!=v&&a.offsetParent?l(a.offsetParent):{x:0,y:0};return{x:a.offsetLeft+b.x,y:a.offsetTop+b.y}},f=!1;a=function(a,c,d){(d?document:b).addEventListener(a,c,!1)};_that_unbind=function(a,c,d){(d?document:b).removeEventListener(a,c,!1)};var m=0,w=0,q={x:0,y:0},c=function(a){return a&&
a.parentNode?k==a?!0:c(a.parentNode):!1},e=function(a){b.style.cursor="-webkit-grab";b.style.cursor="grab";f&&a&&s(l(b));f=!1};a("mousedown",function(a){c(a.target)&&g(a)&&(q=l(k),m=a.pageX,w=a.pageY,f=!0,b.style.cursor="-webkit-grabbing",b.style.cursor="grabbing")});a("mouseup",e,!0);a("mousemove",function(a){f&&g(a)&&(k.style.left=q.x+a.pageX-m+"px",k.style.top=q.y+a.pageY-w+"px",a.preventDefault())},!0);e({})},R=function(a,d,g){return(g||1)*(Math.random()*(d-a)+a)},H=function(a){return a[Math.floor(Math.random()*
a.length)]},Q=function(b){console.log(b);var d=b.c,g,s,k=function(){v();console.log("Booting up...");w.stop().fadeOut(600);m.fadeIn();if(-1!==b.wcc_enable.indexOf(d.body))g=d.body;else{var a;a=b.wcc_enable;if(a.length)a=H(a);else throw Error("\u8bf7\u901a\u77e5\u7ba1\u7406\u5458\u8fdb\u5165\u540e\u53f0\u914d\u7f6e\u6625\u83dc :<");g=a}s=b.wcc[g];p();t(!0)},v=function(a){console.log("Shutting down...");m.hide();clearTimeout(x);clearTimeout(y);w.stop().fadeIn(600)},l=function(){B.jx_wcc_conf=JSON.stringify(d);
console.log("Save config: %s",B.jx_wcc_conf)},f=0,m=a("<div>").appendTo("body").addClass("jx_wcc_main").css({left:d.pos.x,top:d.pos.y}),w=a("<a>").appendTo("body").addClass("jx_wcc_btn_shoukan").text("\u53ec\u5524\u6625\u83dc").hide().click(function(){k();d.hide=!1;l()}),q=a("<div>").appendTo(m).addClass("jx_wcc_face"),c=0,e=a("<div>").appendTo(m).addClass("jx_wcc_chat"),h=a("<div>").appendTo(e).addClass("jx_wcc_cat_con"),p=function(a){a||(c=0);C.add(J).add(K).add(L).stop().slideUp()};a("<a>").text();
var G=[a("<a>").text("\u663e\u793a\u516c\u544a").click(function(){p();c+=5E3;n(b.announcement)}),a("<a>").text("\u4f60\u95ee\u6211\u7b54").click(function(){}),a("<a>").text("\u5b58\u6d3b\u65f6\u95f4").click(function(){p();c+=5E3;n("\u54b1\u5df2\u7ecf\u548c\u4e3b\u4eba\u5171\u540c\u5ea6\u8fc7 "+Math.floor((new Date/1E3-b.since)/86400)+"\u5929 \u4e86\u54e6\uff5e")}),a("<a>").text("\u62cd\u6253\u5582\u98df").click(function(){c+=15E3;n("\u8981\u6765\u70b9\u4ec0\u4e48\u5462~");C.slideToggle();K.slideToggle()}),
a("<a>").text("\u6362 \u4e00 \u53ea").click(function(){p();n("\u4f60\u60f3\u8981\u54ea\u4e00\u53ea\u5462?");L.slideDown()}),a("<a>").text("\u4f20 \u9001 \u95e8").click(function(){c+=15E3;p();J.slideDown()}),a("<a>").text("\u5173\u95ed\u6625\u83dc").click(function(){p();c=1E4;d.hide=!0;l();n("\u8bb0\u5f97\u518d\u53eb\u6211\u51fa\u6765\u54e6~",function(){setTimeout(function(){a(m).fadeOut(600,function(){v();d.hide=!0;l()})},2E3)})}),a("<a>").text("\u8fd4\u56de").click(function(){D(!0);t()})],u=0,S=
function(){0<u&&u--;setTimeout(S,42E4)},C=a("<div>").appendTo(e).append(G).addClass("jx_wcc_chat_m").hide(),K=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide().clickEx("a",function(){c+=3E3;var I="";9<u?n("\u4e3b\u4eba .. ..  \u6211\u5df2\u7ecf\u5403\u4e0d\u4e0b\u4e86 QwQ"):(5<u?I="\u5feb\u5403\u4e0d\u4e0b\u4e86\u2026":3>u&&(I="\u591a\u8c22\u4e3b\u4eba~"),u++,n((I+" "+a(this).attr("r")).trim()))}),L=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide().clickEx("a",function(){d.body=a(this).attr("m");
l();k()}),J=a("<div>").appendTo(e).addClass("jx_wcc_chat_m").hide();a("<div>").appendTo(e).click(function(){C.is(":hidden")?(p(),n("\u9700\u8981\u505a\u70b9\u4ec0\u4e48\u5417?"),c+=15E3,C.slideToggle()):D(!0)}).text("menu").addClass("jx_wcc_ment_btn");var E=a("<img>").appendTo(q).hide(),M=a("<img>").appendTo(q).hide();new X(q[0],m[0],null,function(a){console.log("Save new pos:",a);d.pos=a;l()});var T=!1,U=function(a,b){q.css({width:a.w,height:a.h,backgroundImage:"url("+b+")"})},z={},V=function(a,
b){z[a]&&z[a].h?b(z[a],a):(E[0].onload=function(){z[a]={w:E.width(),h:E.height()};b(z[a],a)},E.attr("src",a))},x=0,A=0,n=function(a,b,c){console.log("doTypeWords: %s",a);clearTimeout(h.data("jx-jqfx-type"));var d=0,e=a.length,f=function(){h.append("\n"==a[d]?"<br>":a[d]);++d<e?h.data("jx-jqfx-type",setTimeout(f,c||20)):b&&b()};h.text("").data("jx-jqfx-type",setTimeout(f,1))},W=0,D=function(a){if(a||4E3<new Date-W)p(!0),W=new Date,n(H(b.randTalk))},N=function(a,c){return b.skin+g+a+(c?"."+c:"")+".png"},
F=[],O=function(){if(A==F.length)A=0,M.hide(),x=setTimeout(O,R(f.time[0],f.time[1],1E3));else{var a=F[A++];M.attr("src",N(f.base,a[0])).css({left:a[1],top:a[2],position:"absolute"}).show();x=setTimeout(O,1E3*a[3])}},Q=function(a){V(N(f.base),function(b,c){U(b,c);A=F.length;x=setTimeout(O,1);y=setTimeout(t,P);D(a)})},P=0,y=0,t=function(a){clearTimeout(y);console.log("_extendDelay: %s",c);!a&&c?(y=setTimeout(t,c),c=0):(P=R(s.time[0]||10,s.time[1]||15,1E3),f=H(s.faces),T="string"!=typeof f,clearTimeout(x),
M.hide(),T?(A=0,F=f.face,Q(a)):V(N(f),function(a,b){U(a,b);y=setTimeout(t,P);D()}))},r;for(r in b.feedPlay)e=b.feedPlay[r],K.append(a("<a>").text(r).attr({f:r,r:e}));for(e=b.wcc_enable.length;e--;)L.append(a("<a>").text(b.wcc[b.wcc_enable[e]].name).attr("m",b.wcc_enable[e]));for(r in b.favLink)J.append(a("<a>").text(r).attr("href",b.favLink[r]));k();S();t();d.hide&&v(!0)};a.ajax({url:G.url,method:"POST",data:{action:"jx_ajax_get_chuncai_opts"},dataType:"json",cache:!0}).success(function(b){Q(a.extend({c:a.parseJSON(B.jx_wcc_conf)||
{pos:{x:a(h).width()-120,y:a(h).height()-200},hide:!1}},b))})}});
